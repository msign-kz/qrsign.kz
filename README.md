# Описание стандарта QRSign

## Требование к QR 

Содержимое QR кода должно быть представлено ссылкой в виде `https://<url>/{id}` (пример - `https://qr.msign.biz/1234567890`). Общая длина содержимого QR не должно превышать 150 символов.

## Требование к процессу подписания

Процесс подписи сообщения проходит в три этапа:

- Получении метаданных о документе
- Получение сообщения
- Получение файлов
- Подписание сообщения - выполняется на устройстве
- Передача подписанных данных на сервер


## Описание этапов

### Получение метаданных о документе

Получение данных осуществляется вызовом ссылки методом GET.

Тело ответа представляет из себя объект в виде:
```
{
	"authRequired": <true|false>,
	"version": 1.0
}
```


### Получение данных сообщения

Получение данных осуществляется вызовом POST запроса на ссылку.

Тело POST запроса представляет из себя объект в виде:

```
{
	"signedUrl": <Подпись сообщения в формате PKCS7 (AUTH), при публичных документах - не обязательно>,
}
```

Тело ответа представляет из себя следующий объект в виде:

```
{
	"packetId": <id пакета>
	"token": <токен при аутентификации, при публичных документах - токен не нужен. Время действия токена - 10 минут. Необходим для дальнейшего скачивания файлов.>
	"name": <наименование пакета>,
	"description": <описание пакета>,
	"dynamic": <true|false>,
	"documents": [
		{
			"documentId": <id документа>,
			"fileName": <название файла>,
			"description": <описание файла>,
			"size": <размер файла>,
			"md5": <md5 hash>,
			"sha1": <sha1 hash>,
			"mimeType": <тип файла>,
			"signType": <тип подписания>,
			"signDetails": [
				{
					"key": <ключ параметр>,
					"value": <значение параметра>
				}, ...
			]
		}, ...
	]
}
```


### Получение файлов 

GET запрос на `<ссылка>/files/{documentId}

В header необходимо проставить следующий параметр - `Authorization: Bearer <token>`

Ответ будет с корректным MIME и размером для скачивания


### Передача подписанных данных на сервер

Передача данных осуществляется вызовом POST запроса на адерс `<ссылка>/signed`.

Тело POST запроса представляет из себя объект в виде:

```
{
  signedDocuments: [
	"documentId": <id документа>,
	"signature": <подписанные данные в виде BASE64>
  ]
}
```

Тело ответа представляет из себя объект в виде:

```
{
	"status": <status code>",
	"signedResponse": [
		{
			"documentId": <id документа>,
			"signatureId": <id подписи>
		}, ...
	]
}
```
