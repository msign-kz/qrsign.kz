# Описание стандарта QRSign

## Требование к QR 

Содержимое QR кода должно быть представлено ссылкой. Ссылка обязательно должна быть  в виде `https://<url>` (пример - `https://qr.msign.biz/1234567890`). Для удобства - содержимое QR не должно превышать 150 символов.

## Требование к процессу подписания

Процесс подписания пакета проходит в следующей последовательности:

- Получении служебных данных о пакете
- Получении данных о пакете
- Получение файлов/документов
- Подписание сообщения - выполняется на устройстве
- Передача подписанных данных на сервер


## Описание этапов

### Получение метаданных о документе

Получение данных осуществляется вызовом ссылки методом GET.

Тело ответа представляет из себя объект в виде:
```
{
	"authRequired": <true|false>,
	"version": 1.0
}
```


### Получение данных сообщения

Получение данных осуществляется вызовом POST запроса на ссылку.

Тело POST запроса представляет из себя объект в виде:

```
{
	"signedUrl": <Подпись ссылки+timestamp в формате PKCS7 (AUTH). Политика использования ключа - Шифрование ключей. При публичных документах - не обязательно. >,
}
```

Тело ответа представляет из себя следующий объект в виде:

```
{
	"token": <токен при аутентификации, при публичных документах - токен не нужен. Время действия токена - 10 минут. Необходим для дальнейшего скачивания файлов.>,
	"name": <наименование пакета>,
	"description": <описание пакета>,
	"dynamic": <true|false>, // если значение установлено, то возможно изменились документы, возможно нужно будет скачать новую версию.
	"documents": [
		{
			"documentId": <id документа>,
			"dynamic": <true|false>, // если значение установлено, то можно скачать новую версиюю. иначе статика.
			"fileName": <название файла>,
			"description": <описание файла>,
			"size": <размер файла>,
			"sha256": <sha256 hash>,
			"mimeType": <тип файла>,
			"signType": <тип подписания>,
			"signDetails": [
				{
					"key": <ключ параметр>,
					"value": <значение параметра>
				}, ...
			]
		}, ...
	]
}
```


### Получение файлов 

GET запрос на `<ссылка>/files/{documentId}`

В header необходимо проставить следующий параметр - `Authorization: Bearer <token>` (при публичных документах - необязательно)

Ответ будет с корректным MIME и размером для скачивания


### Передача подписанных данных на сервер

Передача данных осуществляется вызовом POST запроса на адерс `<ссылка>/signed`.

Тело POST запроса представляет из себя объект в виде:

```
{
  signedDocuments: [
	"documentId": <id документа>,
	"signature": <подписанные данные в виде BASE64>
  ]
}
```

Тело ответа представляет из себя объект в виде:

```
{
	"status": <status code>",
	"signedResponse": [
		{
			"documentId": <id документа>,
			"signatureId": <id подписи>
		}, ...
	]
}
```
